<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <title>Welcome to the CryptoScreener !</title>
	<script>
		var lstTokens = new Array();
		////////////////////////////////////////////////////////////////////////////////////////////////////
		// VARIABLE A MODIFIER
		////////////////////////////////////////////////////////////////////////////////////////////////////
		lstTokens.push(["BITCOIN", "coinmarketcap", 1, "", 0.09]);
		lstTokens.push(["ETHEREUM", "coinmarketcap", 1027, "", 0.33]);
		lstTokens.push(["NEO", "coinmarketcap", 1376, "", 4]);
		lstTokens.push(["LITECOIN", "coinmarketcap", 2, "", 0.45]);
		lstTokens.push(["TRON", "coinmarketcap", 1958, "", 2003]);
		lstTokens.push(["FRIENDS", "coinmarketcap", 2626, "", 1299]);
		lstTokens.push(["VERGE", "coinmarketcap", 693, "", 749]);
		lstTokens.push(["HAVVEN", "coinmarketcap", 2586, "", 249.75]);
		lstTokens.push(["TE-FOOD", "coinmarketcap", 2578, "", 2162]);
		lstTokens.push(["ONTOLOGY", "coinmarketcap", 2566, "", 20]);
		lstTokens.push(["ARCBLOCK", "coinmarketcap", 2545, "", 75]);
		lstTokens.push(["POLYMATH-NETWORK", "coinmarketcap", 2496, "", 250]);
		lstTokens.push(["EQUAL", "coinmarketcap", 2479, "", 16000]);
		lstTokens.push(["DROPIL", "coinmarketcap", 2591, "", 1500]);
		lstTokens.push(["DATUM", "coinmarketcap", 2283, "", 196.77]);
		lstTokens.push(["NUCLEUS-VISION", "coinmarketcap", 2544, "", 200]);
		lstTokens.push(["JESUS-COIN", "coinmarketcap", 2520, "", 11500]);
		lstTokens.push(["PUREVIDZ", "coinmarketcap", 1511, "btc", 7400]);
		lstTokens.push(["PECULIUM", "coinmarketcap", 2610, "", 1050]);
		lstTokens.push(["MATRIX-AI-NETWORK", "coinmarketcap", 2474, "", 10]);
		//lstTokens.push(["FDZ", "coinmarketcap", 2474, "", 10]);
		////////////////////////////////////////////////////////////////////////////////////////////////////
		// https://s2.coinmarketcap.com/static/img/coins/32x32/2474.png
		</script>
	<style>
	html * {
		font-family: 'Trebuchet MS', Helvetica, sans-serif;
		background-color: #efeded;
	}
	td {
		height:50px;
		width:200px;
		padding-bottom: 0px;
		border: 1px solid #c2c2c2;
		border-top-right-radius: 10px;		
	}
	th {
		height:20px;
		width:200px;
	}
	div #tokename_green{
		color: green;
	}
	div #tokename_red{
		color: red;
	}
	.pump {
		font-weight: bold;
	}
	.bigpump {
		background-color: green;
		color: white;
		font-weight: bold;
	}
	.bigdump {
		background-color: red;
		color: white;
		font-weight: bold;
	}
	div #rank{
		width:40px;
		text-align: center;
		vertical-align: middle;
	}
	div #market_cap{
		text-align: center;
		vertical-align: middle;
	}
	div #volume{
		text-align: center;
		vertical-align: middle;
	}
	div .cellule{
		display: table;
		width:100%;
		table-layout: fixed; /*Optional*/
		background-color: transparent;
	}
	div .tokenicon{
		display: table-cell;
		width:30%;
	}
	div .tokenicon img {
		width: 90%;
		height: auto;
	}
	div .tokeninfo{
		display: table-cell;
		/* text-align: center; */
		vertical-align: top;
		padding-top: 5px;
	}
	div #token_infos{
		font-size: 12px;
	}
	div #wallet_infos{
		font-size: 10px;
	}
	#sparkline1d {
		display: table;
		width: 100%; /*Optional*/
		table-layout: fixed; /*Optional*/
	
	}
	#sparktext {
		display: table-cell;
		font-size: 10px;
		vertical-align: top;
	}
	#sparkImg1d {
		display: table-cell;
		font-size: 10px;
		
	}
	
	div .sparkline1d{
		display: inline;
	}
	div .sparkline7d{
		display: none;
	}
	.percent_change_green {
		color: green;
	}
	.percent_change_red {
		color: red;
	}
	#header {
		display: table;
		width: 100%; /*Optional*/
		table-layout: fixed; /*Optional*/
		/* border: 1px;
		border-style: inset;
		font-size: 12px; */
	}
	#header .column {
		display: table-cell;
		text-align: center;
		border: 1px solid #c2c2c2;
		border-bottom: 1px solid #777;
		border-top-right-radius: 10px;		
		border-top-left-radius: 10px;
	    /* border-style: inset;
		border-right: 1px;
		border-width: 1px; */
		
	}
	.rowInfos {
		display: table;
		width: 100%; /*Optional*/
		table-layout: fixed; /*Optional*/
		border-spacing: 2px; /*Optional*/
	    border-style: inset;
		border-right: 1px;
		border-left: 2px;
		border-width: 1px;
	}
	.Column {
		display: table-cell;
		font-size: 10px;
		/* background-color: red; /*Optional*/
	}
	.rowBlank {
		width: 100%; /*Optional*/
		height: 5px;
		table-layout: fixed; /*Optional*/
	}	
	.center {
		display: block;
		margin-left: auto;
		margin-right: auto;
		width: 50%;
	}	
	.dateheure {
		font-weight: bold;
	}
	</style>
</head>
<body>
<div id="header" class="inline">
	<div class="column">Market Cap: <span id="gl_MC"></span> <span id="curr_symb1"></span></div>
	<div class="column">24h Volume: <span id="gl_Vol"></span> <span id="curr_symb2"></span></div>
	<div class="column">BTC Dominance: <span id="gl_BTCdom"></span> %</div>
	<div class="column">MaJ: 
		<span id="lastupdate" class="dateheure"></span> |
		<select id="currencyChoice" onchange="choiceCurrency(this.value)">
			<option selected="selected" value="EUR">EUR</option>
			<option value="USD">USD</option>
			<option value="BTC">BTC</option>
			<option value="ETH">ETH</option>
			<option value="NEO">NEO</option>
		</select> |
		1d:<input id="oneDayGraph" name="OneDay" value="oneday" type="checkbox" onchange="changeDayGraph(this)" /> |
		7d:<input id="sevenDayGraph" name="SevenDays" value="sevenday"type="checkbox" onchange="changeDayGraph(this)" />
	</div>
</div>
<div id="dvTable">
</div>
<br />
	<input type="button" value="Refresh Table" onclick="refreshTables()" />
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<script>
	var currency = $("#currencyChoice").val();
	var currencySym = "€";
	var decimals = 5;
	////// Variable pour : COINMARKETCAP :-------------------------------------------------------------------------------
	var cmc_urlAPI = "https://api.coinmarketcap.com/v1/ticker/";
	var cmc_urlAPIinformation = "https://api.coinmarketcap.com/v1/global/?convert=";
	var cmc_urlStaticIMG = "https://s2.coinmarketcap.com/static/img/coins/64x64/";
	var cmc_sparkLine7d = "https://s2.coinmarketcap.com/generated/sparklines/web/7d/usd/";
	var cmc_sparkLine1d = "https://s2.coinmarketcap.com/generated/sparklines/web/1d/usd/";
	//-------------------------------------------------------------------------------------------------------------------
	var tokenName;
	var priceETH = 0;
	var priceBTC = 0;
	var table = $("#mytable");
	
	$(document).ready(startApp());

function startApp() {
	info_CoinMarketCap_Global();
	generateTable(0);
	var newCells = GenerateTokensInfos();
	$("#oneDayGraph").prop('checked', true);
}

function refreshTables() {
	info_CoinMarketCap_Global();
	var newCells = GenerateTokensInfos();
}

function changeDayGraph(choice) {
	<!-- if(choice.checked) { -->
		if(choice.value == "oneday") {
			if(choice.checked) {
				$(".sparkline1d").css("display", "inline");
			}
			else {
				$(".sparkline1d").css("display", "none");
			}
		}
		if(choice.value == "sevenday") {
			if(choice.checked) {
				$(".sparkline7d").css("display", "inline");
			}
			else {
				$(".sparkline7d").css("display", "none");
			}
		}
		//alert("checkbox "+choice.name);
	<!-- } -->
}

function choiceCurrency(type) {
	if(type == "EUR") {
		currency = "EUR";
		currencySym = "€";
		decimals = 5;
	}
	if(type == "USD"){
		currency = "USD";
		currencySym = "$";
		decimals = 5;
	}
	if(type == "BTC"){
		currency = "BTC";
		currencySym = "B";
		decimals = 8;
	}
	if(type == "ETH"){
		currency = "ETH";
		currencySym = "E";
		decimals = 7;
	}
	
	info_CoinMarketCap_Global();
	var newCells = GenerateTokensInfos();
}

function convertDate(timestamp) {
var date = new Date(timestamp*1000);
// Hours part from the timestamp
var hours = date.getHours();
// Minutes part from the timestamp
var minutes = "0" + date.getMinutes();
// Seconds part from the timestamp
var seconds = "0" + date.getSeconds();
// Will display time in 10:30:23 format
var formattedTime = hours + ':' + minutes.substr(-2) + ':' + seconds.substr(-2);
return formattedTime;
}
		
function nFormatter(num, digits) {
	var si = [
		{ value: 1, symbol: "" },
		{ value: 1E3, symbol: " k" },
		{ value: 1E6, symbol: " M" },
		{ value: 1E9, symbol: " B" },
		{ value: 1E12, symbol: " T" },
		{ value: 1E15, symbol: " P" },
		{ value: 1E18, symbol: " E" }
	];
	var rx = /\.0+$|(\.[0-9]*[1-9])0+$/;
	var i;
	for (i = si.length - 1; i > 0; i--) {
		if (num >= si[i].value) {
		  break;
		}
	}
	return (num / si[i].value).toFixed(digits).replace(rx, "$1") + si[i].symbol;
}

function tokenInfo_CoinMarketCap(token, idImage, nbTokens, convert) {
	currency = $("#currencyChoice").val();
	var tokenInfo = new Array();
	var pump = "";
	var curr_convert = "";
	var priceToken = 0;
	if(convert == "") { curr_convert = currency; }
	else { curr_convert = convert.toUpperCase(); }

	// console.log(curr_convert);
	
	var jqxhr = $.getJSON(cmc_urlAPI+token+'/?convert='+curr_convert);
	jqxhr.done(function(data) {
		if(token == "BITCOIN") { 
			priceBTC = (currency == "EUR" ? parseFloat(data[0].price_eur) : parseFloat(data[0].price_usd));
		}
		if(token == "ETHEREUM") { 
			priceETH = (currency == "EUR" ? parseFloat(data[0].price_eur) : parseFloat(data[0].price_usd));
		}
		
		priceToken = calculPriceToken(data, convert.toUpperCase());
		// if(convert == "") {
			// priceToken = (currency == "EUR" ? parseFloat(data[0].price_eur) : parseFloat(data[0].price_usd));
			// priceToken = (currency == "ETH" ? parseFloat(data[0].price_eth) : priceToken);
		// }
		// else if(convert == "btc") {
			// priceToken = parseFloat(data[0].price_btc);
			// currencySym = "B";
			// decimals = 8;
		// }
		// calculPriceToken(priceToken, "btc");
		
		verifyBump_Token(data[0]);
		
		
		var priceWallet = priceToken * nbTokens;
		if(data[0]["percent_change_24h"] > 0) { 
			colorvar = "percent_change_green" 
			colorName = "tokename_green";
		}
		else { 
			colorvar = "percent_change_red" 
			colorName = "tokename_red";
		}
		if(data[0]["percent_change_24h"] > 15 && data[0]["percent_change_24h"] < 30) { 
			pump = "pump"; 
		}
		else if(data[0]["percent_change_24h"] >= 30) { colorName = ""; pump = "bigpump"; }
		else if(data[0]["percent_change_24h"] < -15 && data[0]["percent_change_24h"] > -40) { pump = "pump"; }
		else if(data[0]["percent_change_24h"] <= -40) {  colorName = ""; pump = "bigdump"; }
		
		if(data[0].name.length > 10) { 
			if(data[0].symbol.length >3) { lenTokenName = 5; }
			else { lenTokenName = 8; }
			affTokenName = data[0].name.substring(0,lenTokenName) + "..."; 
		}
		else { affTokenName = data[0].name; }
		
		var tokenInfo = "<div class='cellule'>"+
							"<div class='tokenicon' id=icon><img src='"+cmc_urlStaticIMG+idImage+".png' /></div>"+
							"<div class='tokeninfo' id=text>"+
								"<div id='"+colorName+"' class='"+pump+"'>"+affTokenName+" ("+data[0].symbol+")</div>"+
								"<div id='token_infos' class='"+colorvar+"'>"+
									"<span id='price_eur'>"+priceToken.toFixed(decimals)+" "+currencySym+"</span> <span id='percent_change'>("+data[0]["percent_change_24h"]+"%)</span>"+
								"</div>"+
								"<div id='wallet_infos' class=''>"+
								"<span id='price_eur'>"+priceWallet.toFixed(decimals)+" "+currencySym+"</span> <span id='percent_change'>("+nbTokens+data[0].symbol+")</span>"+
								"</div>"+
							"</div>"+
							
		
						"</div>"+
		"<div class='rowInfos'>"+
		"<div id='rank' class='Column'>RANK<br>"+data[0].rank+"</div><div id='market_cap' class='Column'>MARKET CAP<br>$"+nFormatter(data[0].market_cap_usd, 2)+"</div><div id='volume' class='Column'>VOLUME (24H)<br>$"+nFormatter(data[0]["24h_volume_usd"], 2)+"</div>"+
		"</div>"+
		"<div class='sparkline1d'>"+
		"<div id='sparktext'>1d:</div><div id='sparkImg1d' class='Column'><img class='sparkline' src='"+cmc_sparkLine1d+idImage+".png' /></div>"+
		"</div>"+
		"<div class='sparkline7d'>"+
		"<div id='sparktext'>7d:</div><div id='sparkImg7d' class='Column'><img class='sparkline' src='"+cmc_sparkLine7d+idImage+".png' /></div>"+
		"</div>"+
		"<div class='rowBlank'>"+
		"</div>";		
		$("#"+token).html(tokenInfo);
	});
}

function calculPriceToken(dataToken, coinRef) {
	var convertPrice = 0;
	console.log("CoinRef: " + coinRef);
	if(coinRef == "BTC") {
		convertPrice = parseFloat(dataToken[0].price_btc);
		console.log("BTC=>" + convertPrice);
		currencySym = "B";
		decimals = 8;
	}
	else if(coinRef == "ETH") {
		convertPrice = parseFloat(dataToken[0].price_eth);
		console.log("ETH=>" + convertPrice);
	}
	else if(coinRef == "LTC") {
		convertPrice = parseFloat(dataToken[0].price_ltc);
		console.log("LTC=>" + convertPrice);
	}
	else if(coinRef == "NEO") {
		convertPrice = parseFloat(dataToken[0].price_neo);
		console.log("NEO=>" + convertPrice);
	}
	else if(coinRef == "USD") {
		convertPrice = parseFloat(dataToken[0].price_usd);
		console.log("NEO=>" + convertPrice);
	}
	else {
		convertPrice = parseFloat(dataToken[0].price_eur);
		console.log("EUR=>" + convertPrice);
	}
	//priceToken * priceConvert;

	return convertPrice;
}

function tokenInfo_IDEXmarket(token, idImage, nbTokens, convert) {
	$.post('https://api.idex.market/returnTicker',
    {
        json: {
			market: 'ETH_FDZ'
		}
		}, function(err, resp, body) {
        console.log(body);
	});
}

function info_CoinMarketCap_Global() {
	console.log(cmc_urlAPIinformation+currency);
	var jqxhr = $.getJSON(cmc_urlAPIinformation+currency);
	jqxhr.done(function(data) {
		//console.log(data);
		var dateConvert = convertDate(data.last_updated);
		$("#lastupdate").html(dateConvert);
		if(currency == "EUR") {
			$("#gl_MC").html(nFormatter(data.total_market_cap_eur, 4));
			$("#gl_Vol").html(nFormatter(data.total_24h_volume_eur, 4));
		}
		if(currency == "USD"){
			$("#gl_MC").html(nFormatter(data.total_market_cap_usd, 4));
			$("#gl_Vol").html(nFormatter(data.total_24h_volume_usd, 4));
		}
		if(currency == "ETH"){
			$("#gl_MC").html(nFormatter(data.total_market_cap_eth, 4));
			$("#gl_Vol").html(nFormatter(data.total_24h_volume_eth, 4));
		}
		
		$("#curr_symb1").html(currencySym);
		$("#curr_symb2").html(currencySym);

			if(data.bitcoin_percentage_of_market_cap > 50) { $("#gl_BTCdom").css("color", "red"); }
		else { $("#gl_BTCdom").css("color", "green"); }
		
		$("#gl_BTCdom").html(data.bitcoin_percentage_of_market_cap);
	});	
}

// Hausse du cours d'un token
function pump_Token() {
	
}

// Baisse du cours d'un token
function dump_Token(token) {
	
}

// Grosse hausse du cours d'un token
function verifyBump_Token(token) {
		if(token["percent_change_24h"] > 0) { 
			// colorvar = "percent_change_green" 
			// colorName = "tokename_green";
		}
		else { 
			// colorvar = "percent_change_red" 
			// colorName = "tokename_red";
		}
		
		// if(token["percent_change_24h"] > 15 && token["percent_change_24h"] < 30) { 
			// pump = "pump"; 
		// }
		// else if(token["percent_change_24h"] >= 30) { colorName = ""; pump = "bigpump"; }
		// else if(token["percent_change_24h"] < -15 && token["percent_change_24h"] > -40) { pump = "pump"; }
		// else if(token["percent_change_24h"] <= -40) {  colorName = ""; pump = "bigdump"; }
}

function GenerateTokensInfos() {
	var cells = { };
	$.each(lstTokens, function(key, value) {
		var tokenName = value[0];
		if(value[1] == "coinmarketcap") {
			tokenInfo_CoinMarketCap(tokenName, value[2], parseFloat(value[4]), value[3]);
		}
		else {
			tokenInfo_IDEXmarket(tokenName, value[2], parseFloat(value[4]), value[3]);
		}
	});
	return cells;
}

function generateTable(tokensInfos) {
	//Build an array containing Customer records.
	var nbToken = lstTokens.length;
	var cptToken = 0;
	var numberOfRows = Math.floor(window.innerHeight / 20);
	var numberOfCells = Math.floor(window.innerWidth / 200);
	var nbRow = nbToken / numberOfCells;
	//Create a HTML Table element.
	var table = document.createElement("TABLE");
	table.border = "0";

	for (var r = 0; r < nbRow; r++) {
		row = table.insertRow(-1);
		for (var j = 0; j < numberOfCells; j++) {
			var cell = row.insertCell(-1);
			if(cptToken < nbToken) {
				var tokenName = $(lstTokens[cptToken++]).splice(",");
				cell.id = tokenName[0];
				if(tokenName[1] == "coinmarketcap") {
					var imgLink = "<img src='"+cmc_urlStaticIMG+tokenName[2]+".png' alt='"+tokenName[0]+"' class='center'>";
					//cell.innerHTML = tokenName[0];
					cell.innerHTML = imgLink;
				}
			}
			else{
				cell.id = "vide";
				cell.innerHTML = "";
			}
		}
	}
	var dvTable = document.getElementById("dvTable");
	dvTable.innerHTML = "";
	dvTable.appendChild(table);	
	$('td[id="vide"]').css("border", "0");
}
	</script>
</body>
</html>
