<!DOCTYPE html>
<html>
<head>
    <title>Welcome to the CryptoScreener !</title>
	<script>
	var lstTokens = new Array();
	lstTokens.push(["BITCOIN", "coinmarketcap", 1, "", 0.09]);
	lstTokens.push(["ETHEREUM", "coinmarketcap", 1027, "", 0.33]);
	lstTokens.push(["NEO", "coinmarketcap", 1376, "", 4]);
	lstTokens.push(["LITECOIN", "coinmarketcap", 2, "", 0.45]);
	lstTokens.push(["TRON", "coinmarketcap", 1958, "", 2003]);
	lstTokens.push(["FRIENDS", "coinmarketcap", 2626, "", 1299]);
	lstTokens.push(["VERGE", "coinmarketcap", 693, "", 749]);
	lstTokens.push(["HAVVEN", "coinmarketcap", 2586, "", 249.75]);
	lstTokens.push(["TE-FOOD", "coinmarketcap", 2578, "", 2162]);
	lstTokens.push(["ONTOLOGY", "coinmarketcap", 2566, "", 20]);
	lstTokens.push(["ARCBLOCK", "coinmarketcap", 2545, "", 75]);
	lstTokens.push(["POLYMATH-NETWORK", "coinmarketcap", 2496, "", 250]);
	lstTokens.push(["EQUAL", "coinmarketcap", 2479, "", 16000]);
	lstTokens.push(["DROPIL", "coinmarketcap", 2591, "", 1500]);
	</script>
	<style>
	html * {
		font-family: 'Trebuchet MS', Helvetica, sans-serif;
	}
	td {
		height:50px;
		width:200px;
		padding-bottom: 20px;
	}
	th {
		height:20px;
		width:200px;
	}
	div #tokename_green{
		color: green;
	}
	div #tokename_red{
		color: red;
	}
	.pump {
		font-weight: bold;
	}
	div #rank{
		width:40px;
		text-align: center;
		vertical-align: middle;
	}
	div #market_cap{
		text-align: center;
		vertical-align: middle;
	}
	div #volume{
		text-align: center;
		vertical-align: middle;
	}
	div .cellule{
		display: table;
		width:100%;
		table-layout: fixed; /*Optional*/
	}
	div .tokenicon{
		display: table-cell;
		width:30%;
	}
	div .tokenicon img {
		width: 90%;
		height: auto;
	}
	div .tokeninfo{
		display: table-cell;
		/* text-align: center; */
		vertical-align: top;
		padding-top: 5px;
	}
	div #token_infos{
		font-size: 12px;
	}
	div #wallet_infos{
		font-size: 10px;
	}
	div .sparkline1d{
		display: none;
	}
	.percent_change_green {
		color: green;
	}
	.percent_change_red {
		color: red;
	}
	.pump {
		font-weight: bold;
	}
	#header {
		display: table;
		width: 100%; /*Optional*/
		table-layout: fixed; /*Optional*/
		border: 1px;
		border-style: inset;
	}
	#header .column {
		display: table-cell;
		text-align: center;
	    border-style: inset;
		border-right: 1px;
		border-width: 1px;
		
	}
	.rowInfos {
		display: table;
		width: 100%; /*Optional*/
		table-layout: fixed; /*Optional*/
		border-spacing: 2px; /*Optional*/
	    border-style: inset;
		border-right: 1px;
		border-left: 2px;
		border-width: 1px;
	}
	.Column {
		display: table-cell;
		font-size: 10px;
		/* background-color: red; /*Optional*/
	}
	.center {
		display: block;
		margin-left: auto;
		margin-right: auto;
		width: 50%;
	}	
	.dateheure {
		font-weight: bold;
	}
	</style>
</head>
<body>
<div id="header" class="inline">
	<div class="column">Market Cap: <span id="gl_MC"></span> <span id="curr_symb1"></span></div>
	<div class="column">24h Volume: <span id="gl_Vol"></span> <span id="curr_symb2"></span></div>
	<div class="column">BTC Dominance: <span id="gl_BTCdom"></span> %</div>
	<div class="column">Last Update: 
		<span id="lastupdate" class="dateheure"></span> |
		<select id="currencyChoice" onchange="choiceCurrency(this.value)">
			<option selected="selected" value="EUR">EUR</option>
			<option value="USD">USD</option>
			<option value="ETH">ETH</option>
		</select> 
	</div>
</div>
<div id="dvTable">
</div>
<br />
	<input type="button" value="Refresh Table" onclick="GenerateTokensInfos()" />
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<script>
	//console.log($("#currencyChoice").val());
	var currency = $("#currencyChoice").val();
	var currencySym = "€";
	////// Variable pour : COINMARKETCAP :-------------------------------------------------------------------------------
	var cmc_urlAPI = "https://api.coinmarketcap.com/v1/ticker/";
	var cmc_urlAPIinformation = "https://api.coinmarketcap.com/v1/global/?convert=";
	var cmc_urlStaticIMG = "https://s2.coinmarketcap.com/static/img/coins/64x64/";
	var cmc_sparkLine7d = "https://s2.coinmarketcap.com/generated/sparklines/web/7d/usd/";
	var cmc_sparkLine1d = "https://s2.coinmarketcap.com/generated/sparklines/web/1d/usd/";
	//-------------------------------------------------------------------------------------------------------------------
	var tokenName;
	var priceETH = 0;
	var priceBTC = 0;
	var table = $("#mytable");
	$(document).ready(startApp());

function startApp() {
	info_CoinMarketCap_Global();
	generateTable(0);
	var newCells = GenerateTokensInfos();
}

function choiceCurrency(type) {
	if(type == "EUR") {
		currency = "EUR";
		currencySym = "€";
	}
	if(type == "USD"){
		currency = "USD";
		currencySym = "$";
	}
	if(type == "ETH"){
		currency = "ETH";
		currencySym = "E";
	}
	
	info_CoinMarketCap_Global();
	var newCells = GenerateTokensInfos();
}

function convertDate(timestamp) {
var date = new Date(timestamp*1000);
// Hours part from the timestamp
var hours = date.getHours();
// Minutes part from the timestamp
var minutes = "0" + date.getMinutes();
// Seconds part from the timestamp
var seconds = "0" + date.getSeconds();
// Will display time in 10:30:23 format
var formattedTime = hours + ':' + minutes.substr(-2) + ':' + seconds.substr(-2);
return formattedTime;
}
		
function nFormatter(num, digits) {
	var si = [
		{ value: 1, symbol: "" },
		{ value: 1E3, symbol: " k" },
		{ value: 1E6, symbol: " M" },
		{ value: 1E9, symbol: " B" },
		{ value: 1E12, symbol: " T" },
		{ value: 1E15, symbol: " P" },
		{ value: 1E18, symbol: " E" }
	];
	var rx = /\.0+$|(\.[0-9]*[1-9])0+$/;
	var i;
	for (i = si.length - 1; i > 0; i--) {
		if (num >= si[i].value) {
		  break;
		}
	}
	return (num / si[i].value).toFixed(digits).replace(rx, "$1") + si[i].symbol;
}

function tokenInfo_CoinMarketCap(token, idImage, nbTokens) {
	var tokenInfo = new Array();
	var pump = "";
	var jqxhr = $.getJSON(cmc_urlAPI+token+'/?convert='+currency);
	jqxhr.done(function(data) {
		if(token == "BITCOIN") { 
			priceBTC = (currency == "EUR" ? parseFloat(data[0].price_eur) : parseFloat(data[0].price_usd));
		}
		if(token == "ETHEREUM") { 
			priceETH = (currency == "EUR" ? parseFloat(data[0].price_eur) : parseFloat(data[0].price_usd));
		}
		var priceToken = (currency == "EUR" ? parseFloat(data[0].price_eur) : parseFloat(data[0].price_usd));
		priceToken = (currency == "ETH" ? parseFloat(data[0].price_eth) : priceToken);
		
		var priceWallet = priceToken * nbTokens;
		if(data[0]["percent_change_24h"] > 0) { 
			colorvar = "percent_change_green" 
			colorName = "tokename_green";
		}
		else { 
			colorvar = "percent_change_red" 
			colorName = "tokename_red";
		}
		if(data[0]["percent_change_24h"] > 15) { 
			pump = "pump"; 
		}
		//else if(data[0]["percent_change_24h"] > -5) { colorvar += " pump"; }
		var tokenInfo = "<div class='cellule'>"+
							"<div class='tokenicon' id=icon><img src='"+cmc_urlStaticIMG+idImage+".png' /></div>"+
							"<div class='tokeninfo' id=text>"+
								"<div id='"+colorName+"' class='"+pump+"'>"+data[0].name+" ("+data[0].symbol+")</div>"+
								"<div id='token_infos' class='"+colorvar+"'>"+
									"<span id='price_eur'>"+priceToken.toFixed(5)+" "+currencySym+"</span> <span id='percent_change'>("+data[0]["percent_change_24h"]+"%)</span>"+
								"</div>"+
								"<div id='wallet_infos' class=''>"+
								"<span id='price_eur'>"+priceWallet.toFixed(5)+" "+currencySym+"</span> <span id='percent_change'>("+nbTokens+")</span>"+
								"</div>"+
							"</div>"+
							
		
						"</div>"+
		"<div class='rowInfos'>"+
		"<div id='rank' class='Column'>RANK<br>"+data[0].rank+"</div><div id='market_cap' class='Column'>MARKET CAP<br>$"+nFormatter(data[0].market_cap_usd, 2)+"</div><div id='volume' class='Column'>VOLUME (24H)<br>$"+nFormatter(data[0]["24h_volume_usd"], 2)+"</div>"+
		"</div>"+
		"<div class='sparkline7d'>"+
		"<div id='rank' class='Column'><img class='sparkline' src='"+cmc_sparkLine7d+idImage+".png' /></div>"+
		"</div>"+
		"<div class='sparkline1d'>"+
		"<div id='rank' class='Column'><img class='sparkline' src='"+cmc_sparkLine1d+idImage+".png' /></div>"+
		"</div>"+
		"<div class='rowInfos'>"+
		"</div>";		
		$("#"+token).html(tokenInfo);
	});
}

function info_CoinMarketCap_Global() {
	console.log(cmc_urlAPIinformation+currency);
	var jqxhr = $.getJSON(cmc_urlAPIinformation+currency);
	jqxhr.done(function(data) {
		//console.log(data);
		var dateConvert = convertDate(data.last_updated);
		$("#lastupdate").html(dateConvert);
		if(currency == "EUR") {
			$("#gl_MC").html(nFormatter(data.total_market_cap_eur, 4));
			$("#gl_Vol").html(nFormatter(data.total_24h_volume_eur, 4));
		}
		if(currency == "USD"){
			$("#gl_MC").html(nFormatter(data.total_market_cap_usd, 4));
			$("#gl_Vol").html(nFormatter(data.total_24h_volume_usd, 4));
		}
		if(currency == "ETH"){
			$("#gl_MC").html(nFormatter(data.total_market_cap_eth, 4));
			$("#gl_Vol").html(nFormatter(data.total_24h_volume_eth, 4));
		}
		
		$("#curr_symb1").html(currencySym);
		$("#curr_symb2").html(currencySym);

			if(data.bitcoin_percentage_of_market_cap > 50) { $("#gl_BTCdom").css("color", "red"); }
		else { $("#gl_BTCdom").css("color", "green"); }
		
		$("#gl_BTCdom").html(data.bitcoin_percentage_of_market_cap);
	});	
}

function GenerateTokensInfos() {
	var cells = { };
	$.each(lstTokens, function(key, value) {
		var tokenName = value[0];
		tokenInfo_CoinMarketCap(tokenName, value[2], parseFloat(value[4]));
	});
	return cells;
}

function generateTable(tokensInfos) {
	//Build an array containing Customer records.
	var nbToken = lstTokens.length;
	var cptToken = 0;
	var numberOfRows = Math.floor(window.innerHeight / 20);
	var numberOfCells = Math.floor(window.innerWidth / 200);
	var nbRow = nbToken / numberOfCells;
	//Create a HTML Table element.
	var table = document.createElement("TABLE");
	table.border = "0";

	for (var r = 0; r < nbRow; r++) {
		row = table.insertRow(-1);
		for (var j = 0; j < numberOfCells; j++) {
			var cell = row.insertCell(-1);
			if(cptToken < nbToken) {
				var tokenName = $(lstTokens[cptToken++]).splice(",");
				cell.id = tokenName[0];
				var imgLink = "<img src='"+cmc_urlStaticIMG+tokenName[2]+".png' alt='"+tokenName[0]+"' class='center'>";
				//cell.innerHTML = tokenName[0];
				cell.innerHTML = imgLink;
			}
			else{
				cell.id = "";
				cell.innerHTML = "";
			}
		}
	}
	var dvTable = document.getElementById("dvTable");
	dvTable.innerHTML = "";
	dvTable.appendChild(table);	
}
	</script>
</body>
</html>
