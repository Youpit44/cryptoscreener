<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <!-- <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous"> -->
    <link rel="stylesheet" href="./js/bootstrap/4.1.1/css/bootstrap.min.css">
    <!-- integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous"> -->
    <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css"> -->
    <link rel="stylesheet" href="./css/font-awesome/4.4.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="./css/style.css">
    <title>Title</title>
</head>

<body>
    <nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top">
        <a class="navbar-brand" href="#">CryptoScreener</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarsExampleDefault">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="dropdown01" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Indispensables</a>
                    <div class="dropdown-menu" aria-labelledby="dropdown01">
                        <a class="dropdown-item" href="#" target="_blank">Etherscan.io</a>
                        <a class="dropdown-item" href="#" target="_blank">Ethplorer.io</a>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item" href="#" target="_blank">CoinMarketCap.com</a>
                        <a class="dropdown-item" href="#" target="_blank">DeltaBalances.github.io</a>
                    </div>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="dropdown01" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Liens Markets</a>
                    <div class="dropdown-menu" aria-labelledby="dropdown01">
                        <div class="dropdown-header">Liens avec Référent</div>
                        <a class="dropdown-item" href="#" target="_blank">Coinbase</a>
                        <a class="dropdown-item" href="#" target="_blank">Binance</a>
                        <a class="dropdown-item" href="#" target="_blank">Kucoin</a>
                        <a class="dropdown-item" href="#" target="_blank">Huobi-Pro</a>
                        <div class="dropdown-divider"></div>
                        <div class="dropdown-header">Liens sans Référent</div>
                        <a class="dropdown-item" href="#" target="_blank">Coinbase</a>
                        <a class="dropdown-item" href="#" target="_blank">Binance</a>
                        <a class="dropdown-item" href="#" target="_blank">Kucoin</a>
                        <a class="dropdown-item" href="#" target="_blank">Huobi-Pro</a>
                    </div>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="dropdown01" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Liens DEX</a>
                    <div class="dropdown-menu" aria-labelledby="dropdown01">
                        <a class="dropdown-item" href="#" target="_blank">EtherDelta</a>
                        <a class="dropdown-item" href="#" target="_blank">ForkDelta</a>
                        <a class="dropdown-item" href="#" target="_blank">IDEX</a>
                        <a class="dropdown-item" href="#" target="_blank">DDEX</a>
                        <a class="dropdown-item" href="#" target="_blank">Switcheo</a>
                    </div>
                </li>

                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="dropdown01" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Channel Télégram</a>
                    <div class="dropdown-menu" aria-labelledby="dropdown01">
                        <a class="dropdown-item" href="#" target="_blank">Cryptogains.fr - Chat</a>
                        <a class="dropdown-item" href="#" target="_blank">Cryptogains.fr - Airdrop</a>
                        <a class="dropdown-item" href="#" target="_blank">La French Pool</a>
                    </div>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="dropdown01" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Wallets</a>
                    <div class="dropdown-menu" aria-labelledby="dropdown01">
                        <a class="dropdown-item" href="#" target="_blank">MyEtherWallet</a>
                        <a class="dropdown-item" href="#" target="_blank">MyEther</a>
                        <a class="dropdown-item" href="#" target="_blank">Neo</a>
                        <a class="dropdown-item" href="#" target="_blank">Waves</a>
                    </div>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="dropdown01" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Options</a>
                    <div class="dropdown-menu" aria-labelledby="dropdown01">
                        <div class="form-check">
                            <label class="form-check-label"><input id="cb_ModeCS" type="checkbox" class="form-check-input" value="">Mode Online</label>
                        </div>
                        <div class="form-check">
                            <label class="form-check-label"><input id="cb_LocalWallet" type="checkbox" class="form-check-input" value="">Wallet Local</label>
                        </div>
                        <div class="form-check disabled">
                            <label class="form-check-label"><input type="checkbox" class="form-check-input" value="" disabled>Reset</label>
                        </div>
                        <div class="form-check">
                            <label class="form-check-label"><input id="cb_graphDay" type="checkbox" class="form-check-input" value="">Graphiques</label>
                        </div>
                    </div>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="currencyChoice" data-toggle="dropdown">EUR</a>
                    <div class="dropdown-menu">
                        <a id="currEUR" class="dropdown-item active" href="#">EUR</a>
                        <a id="currUSD" class="dropdown-item" href="#">USD</a>
                        <a id="currBTC" class="dropdown-item disabled" href="#">BTC</a>
                        <a id="currETH" class="dropdown-item disabled" href="#">ETH</a>
                        <a id="currLTC" class="dropdown-item disabled" href="#">LTC</a>
                        <a id="currNEO" class="dropdown-item disabled" href="#">NEO</a>
                    </div>
                </li>
            </ul>
            <ul class="nav nav-pills">
                <li class="nav-item">
                    <span class="btn btn-light">Bal: <span id="wallet_Balance" class="badge">0</span></span>
                </li>
                <li class="nav-item">
                    <span id="bt_glMC" class="btn btn-info">M.Cap: <span id="gl_MC" class="badge badge-light">0</span></span>
                </li>
                <li class="nav-item">
                    <span id="bt_glVol" class="btn btn-info">24h Vol: <span id="gl_Vol" class="badge badge-light">0</span></span>
                </li>
                <li class="nav-item">
                    <span id="bt_glBTCDom" class="btn btn-secondary">BTC Dom: <span id="gl_BTCdom" class="badge badge-light">0%</span></span>
                </li>
            </ul>
            <!--<form class="form-inline my-2 my-lg-0">
            <input class="form-control mr-sm-2" type="text" placeholder="Search" aria-label="Search">
            <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
          </form> -->
        </div>
    </nav>
    <div id="alertRubbon" class="">
        <button type="button" class="close" data-dismiss="alert">&times;</button>
        <span id="alert_msg"></span>
    </div>

    <main role="main" class="container-fluid">
        <div id="lstCoins" class="row"></div>
        <hr id="separation" />
        <div id="lstTokens" class="row"></div>
    </main>
    <!-- /.container -->

    <footer class="footer">
        <div class="row no-gutters">
            <div class="col-md-1" style="padding-left: 10px;line-height: 100%;">
                <div class="d-flex flex-column">
                    <div class="p-2 small text-center" style="padding-left: 10px">
                        <span id="modeCS" class="badge">offline</span>
                    </div>
                    <div class="p-2 small text-center" style="padding-left: 10px">
                        <a class="" href="https://github.com/youpit44/cryptoscreener" target="_blank">v<span id="verCS">x.x</span></a>
                    </div>
                </div>
            </div>
            <div class="col-md-10" style="line-height: 100%;">
                <div class="d-flex flex-column">
                    <div class="p-2 small text-center" style="padding-left: 10px">2018 / upete (at) spootnik.fr</div>
                    <div id="all_Wallets" class="p-2 small text-center" style="padding-left: 10px">Eth:</div>
                </div>
            </div>
            <div class="col-md-1">
                <button type="button" data-toggle="modal" title="Popover Header" class="btn btn-primary btn-lg float-right" data-target="#myModal">Aide</button>
            </div>
        </div>

    </footer>
    <!-- The Modal -->
    <div class="modal" id="myModal">
        <div class="modal-dialog">
            <div class="modal-content">

                <!-- Modal Header -->
                <div class="modal-header">
                    <h4 class="modal-title">CryptoScreener</h4>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>

                <!-- Modal body -->
                <div class="modal-body">
                    Bienvenue dans l'installation de CryptoScreener.
                </div>

                <!-- Modal footer -->
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-dismiss="modal">Fermer</button>
                </div>

            </div>
        </div>
    </div>
    <!-- <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T" crossorigin="anonymous"></script> -->
    <script src="./js/jquery-3.3.1.min.js"></script>
    <!-- integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script> -->
    <script src="./js/popper.js/1.14.3/umd/popper.min.js"></script>
    <!-- integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script> -->
    <script src="./js/bootstrap/4.1.1/js/bootstrap.min.js"></script>
    <!-- integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T" crossorigin="anonymous"></script> -->
    <script src="./js/initScreener.js"></script>
    <script src="./js/apiCryptoScreener.js"></script>
    <script src="./js/libCryptoScreener.js"></script>
    <script src="./js/configCryptoScreener.js"></script>
    <script>
        /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        // VARIABLES  
        //
        var lst_CMC_ID_Tokens = new Array();

        var tokenName = "Bitcoin";
        //var currency = "€";

        var cmc_sparkLine7d = "https://s2.coinmarketcap.com/generated/sparklines/web/7d/usd/";

        var decimals = 0;
        var lst_CMC_ID_Tokens = new Array();
        var table = $("#mytable");
        var currency = $("#currencyChoice").text().trim();
        var currencySym = "€";
        var gain_loss = 0;
        var indexOrder = "DESC";
        var indexItem = 2;
        var walletETH;

        /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        // START APPLICATION
        /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        eventsCryptoScreener();

        $(document).ready(startApp());
        /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        // END APPLICATION
        /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


        /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        // FUNCTIONS START 
        //
        function startApp() {
            if (isReady()) {
                $("#alert_msg").html("<strong>Success!</strong> Chargement des données.");
                $("#alertRubbon").addClass("alert alert-success alert-dismissible fade show");
                if (isUpdate()) {
                    majCryptoScreener();
                }
                //alert("marche ");
                initScreenerConfiguration();
                setScreenerParam();
                info_CoinMarketCap_Global();
                lst_CMC_ID_Tokens = JSON.parse(localStorage.getItem('cs_CMClistID'));
                list_All_CMCTokens = loadCMC_Tokens();

            } else {

                $("#alert_msg").html("<strong>Erreur!</strong> Chargement des données.");
                $("#alertRubbon").addClass("alert alert-danger alert-dismissible fade show");
                install_CryptoScreener();
            }


            get_LocalWallet();
            read_walletETH_DeltaBalances(configScreener.walletName);
            // console.log(smallListCoins);

            changeCurrency(configScreener.currencyDefault);

            verifyBalances();

            //console.log(walletBalance);
            //makeCard();
            $('.close').alert("close");

        }

        function read_walletETH_DeltaBalances(walletFile) {
            var listAllTokens = [];
            $.ajax({
                type: "GET",
                url: walletFile,
                dataType: "text",
                async: false,
                success: function(data) {
                    listAllTokens = processData(data);
                    var tokenName;
                    $.each(listAllTokens, function(key, values) {
                        $.each(values, function(header, value) {
                            var splitLine = value.split(":");
                            var idImgToken = 0;
                            var rankToken = 0;
                            var slug = "";
                            var _symbol = "";
                            var _tokenName = "";
                            if (splitLine[0] == "Token") {
                                tokenName = splitLine[1];
                                if (tokenName.indexOf('(') > -1) {
                                    tokenName = tokenName.substring(0, tokenName.indexOf('('));
                                }
                                var nbTokens = values[6].split(":");
                                var contractAddress = values[9].split(":");
                                //var totalTokens = parseFloat(nbTokens[1]) * token[0].price_eur;
                                if (exceptTokens.indexOf(tokenName) == -1) {
                                    var cmc_idToken = lst_CMC_ID_Tokens.filter(filterBySymbol, tokenName);
                                    if (cmc_idToken[0] != null) {
                                        idImgToken = cmc_idToken[0].id;
                                        rankToken = cmc_idToken[0].rank;
                                        slug = cmc_idToken[0].slug;
                                        _symbol = cmc_idToken[0].symbol;
                                        _tokenName = cmc_idToken[0].name;
                                        // console.log(tokenName);
                                        // console.log(cmc_idToken[0]);
                                    } else {
                                        _tokenName = (tokenName).toUpperCase();
                                        _symbol = _tokenName;
                                    }
                                    if (contractAddress[1] != "Not a token") {
                                        //lstGoodTokens[token[0].rank] = [token[0].id, token[0].symbol, token[0].rank, token[0].price_btc, token[0]["percent_change_24h"], token[0].market_cap_usd, token[0]["24h_volume_usd"], parseFloat(nbTokens[1]), token[0].name, token[0].price_usd, token[0].price_eur, contractAddress[1], cmc_idToken[0].id];
                                        // if(contractAddress[1]){
                                        //     getInfoERC20Token
                                        // }
                                        //smallListTokens.push([(tokenName).toUpperCase(), rankToken, idImgToken, parseFloat(nbTokens[1]), contractAddress[1]]);
                                        smallListTokens.push({
                                            name: _tokenName,
                                            rank: rankToken,
                                            symbol: _symbol,
                                            slug: slug,
                                            img: idImgToken,
                                            balance: parseFloat(nbTokens[1]),
                                            contract: contractAddress[1],
                                            wallet: "deltabalances"
                                        });

                                    } else {
                                        //var cmc_idToken = lst_CMC_ID_Tokens.filter(filterBySlug, (value[0]).toUpperCase());
                                        // console.log(values);
                                        //lstGoodCoins[token[0].rank] = [token[0].id, token[0].symbol, token[0].rank, token[0].price_btc, token[0]["percent_change_24h"], token[0].market_cap_usd, token[0]["24h_volume_usd"], parseFloat(nbTokens[1]), token[0].name, token[0].price_usd, token[0].price_eur, contractAddress[1], cmc_idToken[0].id];
                                        // smallListCoins.push([(tokenName).toUpperCase(), rankToken, idImgToken, parseFloat(nbTokens[1]), contractAddress[1]]);
                                    }
                                    // console.log(cmc_idToken);
                                }
                            }
                        });
                        //console.log(smallListTokens);

                    });
                }
            });

            // console.log(smallListTokens);
            // smallListTokens = smallListTokens.reduce(function(item, e1) {
            //     var matches = item.filter(function(e2) {
            //         return e1[0] == e2[0];
            //     });
            //     if (matches.length == 0) {
            //         item.push(e1);
            //     } else {
            //         exceptTokens.push(e1);
            //     }
            //     return item;
            // }, []);

            // console.log(exceptTokens);
            // console.log(smallListTokens);

        }




        function verifyBalances() {
            var last_balance = JSON.parse(localStorage.getItem('cs_balances'));
            changeWalletBalance();
            let balance = currencySym + walletBalance.toFixed(2);
            $("#wallet_Balance").html(balance);

            if (walletBalance > last_balance.EUR) {
                $("#wallet_Balance").addClass("badge-success");
            } else {
                $("#wallet_Balance").addClass("badge-danger");
            }
        }

        function makeCard() {
            console.log("Load: " + smallListCoins.length + " Coins");
            $.each(smallListCoins, function(key, token) {
                if (token.slug != "") {
                    var _symbol = "";
                    var cmc_TokenInfo = list_All_CMCTokens.filter(filterByID, (token.slug).toUpperCase());
                    var tokenInfo = cmc_TokenInfo[0];
                    if (symbol[token.symbol]) {
                        _symbol = symbol[token.symbol];
                    } else {
                        _symbol = token.symbol;
                    }
                    var tokenPrice = parseFloat(tokenInfo["price_" + currency.toLowerCase()]);
                    var tokenMCap = nFormatter(parseFloat(tokenInfo["market_cap_" + currency.toLowerCase()]), 3);
                    var tokenVolume = nFormatter(parseFloat(tokenInfo["24h_volume_" + currency.toLowerCase()]), 3);

                    ////////////////////////////////////////////////////////////////////////////////////
                    // Création d'un Token
                    setTokenBadge(
                        token.name,
                        _symbol,
                        token.symbol,
                        token.slug,
                        tokenPrice.toFixed(decimals),
                        parseFloat(tokenInfo["percent_change_24h"]),
                        token.rank,
                        tokenMCap,
                        tokenVolume,
                        token.balance,
                        token.img,
                        "lstCoins"
                    );
                    // console.log(cmc_TokenInfo[0]);
                    //console.log(cmc_TokenInfo);
                }
            });

            console.log("Load: " + smallListTokens.length + " Tokens");
            $.each(smallListTokens, function(key, token) {
                var _symbol = "";
                var cmc_TokenInfo = list_All_CMCTokens.filter(filterByID, (token.slug).toUpperCase());
                if (cmc_TokenInfo.length > 0) {
                    var tokenInfo = cmc_TokenInfo[0];
                    if (symbol[token.symbol]) {
                        _symbol = symbol[token.symbol];
                    } else {
                        _symbol = token.symbol;
                    }
                    var tokenPrice = parseFloat(tokenInfo["price_" + currency.toLowerCase()]);
                    var tokenMCap = nFormatter(parseFloat(tokenInfo["market_cap_" + currency.toLowerCase()]), 3);
                    var tokenVolume = nFormatter(parseFloat(tokenInfo["24h_volume_" + currency.toLowerCase()]), 3);

                    //////////////////////////////////////////////////////////////////////////////////
                    // Création d'un Token
                    setTokenBadge(
                        token.name,
                        _symbol,
                        token.symbol,
                        token.slug,
                        tokenPrice.toFixed(decimals),
                        parseFloat(tokenInfo["percent_change_24h"]),
                        token.rank,
                        tokenMCap,
                        tokenVolume,
                        token.balance,
                        token.img,
                        "lstTokens"
                    );
                }
                // console.log(cmc_TokenInfo[0]);
                // console.log(cmc_TokenInfo);
            });
            ////////////////////////////////////////////////////////////////////////////////////
            // Création d'un Token
            // setTokenBadge("Bitcoin", symbol.BTC, "BTC", 6984.27, 0.77, 0.09, 1);
            ////////////////////////////////////////////////////////////////////////////////////
            // Création d'un Token
            // setTokenBadge("Ethereum", symbol.ETH, "ETH", 585.65, -5.52, 0.10, 1027);
            ////////////////////////////////////////////////////////////////////////////////////
            // Création d'un Token
            // setTokenBadge("Neo", symbol.NEO, "Neo", 51.32, -10.53, 1, 1376);
            ////////////////////////////////////////////////////////////////////////////////////

        }

        function get_LocalWallet() {
            var nbCoins = 0;
            $.each(lstCoins, function(key, value) {
                //console.log(value);
                var coinName = value[0].toLowerCase();
                if (value[1] == "coinmarketcap") {
                    var cmc_idToken = lst_CMC_ID_Tokens.filter(filterBySlug, (value[0]).toUpperCase());
                    smallListCoins.push({
                        name: cmc_idToken[0].name,
                        rank: cmc_idToken[0].rank,
                        symbol: (cmc_idToken[0].symbol).toUpperCase(),
                        slug: cmc_idToken[0].slug,
                        img: cmc_idToken[0].id,
                        balance: value[4],
                        contract: "Not Token",
                        wallet: "local"
                    });
                    if (value[5] != "") {
                        list_Wallets_Online.push({
                            name: cmc_idToken[0].name,
                            balance: value[4],
                            address: value[5]
                        })
                    }
                } else {
                    // tokenInfo_IDEXmarket(coinName, value[2], parseFloat(value[4]), value[3]);
                }
            });
            // console.log(smallListCoins);
            $.each(lstTokens, function(key, value) {
                var coinName = value[0].toLowerCase();
                if (value[1] == "coinmarketcap") {
                    //if (exceptTokens.indexOf((value[0]).toUpperCase()) > -1) {
                    var cmc_idToken = lst_CMC_ID_Tokens.filter(filterBySlug, (value[0]).toUpperCase());
                    smallListTokens.push({
                        name: cmc_idToken[0].name,
                        rank: cmc_idToken[0].rank,
                        symbol: (cmc_idToken[0].symbol).toUpperCase(),
                        slug: cmc_idToken[0].slug,
                        img: cmc_idToken[0].id,
                        balance: value[4],
                        contract: "",
                        wallet: "local"
                    });
                    //}
                } else {
                    // tokenInfo_IDEXmarket(coinName, value[2], parseFloat(value[4]), value[3]);
                }
            });
            // console.log(smallListCoins);

            return false;
        }


        function setScreenerParam() {
            currency = configScreener.currencyDefault;
            // console.log(currency);
            $("#currencyChoice").text(currency);
            $(".dropdown-item").removeClass("active");
            $("#curr" + currency).addClass("active");
            if (configScreener.onlineMode) {
                $("#modeCS").text("online");
                $("#modeCS").addClass("badge-success");
                $("#cb_ModeCS").prop("checked", "checked");
            } else {
                $("#modeCS").text("offline");
                $("#modeCS").addClass("badge-danger");
            }
            $("#verCS").text(configScreener.version);
            if (configScreener.localWallet) {
                $("#cb_LocalWallet").prop("checked", "checked");
            }
            if (configScreener.graphDisplay) {
                $("#cb_graphDay").prop("checked", "checked");
                // $(".card-footer").css("display", "block");
            }
            // $.each()
            $("#all_Wallets").text(localStorage.getItem('cs_balances'));
        }


        function setTokenBadge(tokenName, symbol, short, slug, tokenprice, pricechange, rank, mcap, volume, nbtokens, id_flag, output) {
            var totalWallet = tokenprice * nbtokens;
            walletBalance += totalWallet;
            // console.log(tokenName + ": " + totalWallet + " > " + walletBalance);
            var signChange = "";
            var pump = false;
            var dump = false;
            var badgeText = "";
            var cl_badge = "";
            var cl_card = "";
            var cl_change = "";
            if (pricechange > 0) {
                signChange = "+";
            }

            tokenBadge = templateBadge.replace(/_TOKEN_/gi, tokenName);
            tokenBadge = tokenBadge.replace(/_SLUG_/gi, slug);
            tokenBadge = tokenBadge.replace(/_SHT_/gi, short);
            tokenBadge = tokenBadge.replace(/_S_/gi, symbol);
            tokenBadge = tokenBadge.replace(/_TokenP_/g, currencySym + tokenprice);
            tokenBadge = tokenBadge.replace(/_WalletP_/g, currencySym + totalWallet.toFixed(_decimals.EUR));
            tokenBadge = tokenBadge.replace(/_Currency_/g, currencySym);

            tokenBadge = tokenBadge.replace(/_RANK_/g, rank);
            tokenBadge = tokenBadge.replace(/_MCAP_/g, mcap);
            tokenBadge = tokenBadge.replace(/_VOLUME_/g, volume);

            // tokenBadge = tokenBadge.replace(/_PChange_/g, pricechange);
            tokenBadge = tokenBadge.replace(/_PChange_/g, signChange + pricechange);
            tokenBadge = tokenBadge.replace(/_NBToken_/g, nbtokens);
            tokenBadge = tokenBadge.replace(/_ID_FLAG_/g, id_flag);
            $("#" + output).append(tokenBadge);
            //$("#"+tokenName+" #headerCard").addClass(colorCard.warning);

            switch (true) {
                case (pricechange <= -50):
                    dump = true;
                    badgeText = "Dump";
                    cl_badge = colorBadge.danger;
                    cl_card = colorCard.danger;
                    break;
                case (pricechange <= -30):
                    dump = true;
                    badgeText = "Dump";
                    cl_badge = colorBadge.danger;
                    cl_change = colorBadge.danger;
                    break;
                case (pricechange <= -15):
                    cl_badge = colorBadge.danger;
                    cl_change = colorBadge.danger;
                    break;
                case (pricechange < 0):
                    cl_badge = colorBadge.danger;
                    cl_change = colorBadge.danger;
                    break;
                case (pricechange >= 50):
                    pump = true;
                    badgeText = "Pump";
                    cl_card = colorCard.success;
                    cl_badge = colorBadge.success;
                    break;
                case (pricechange >= 15):
                    pump = true;
                    badgeText = "Pump";
                    cl_badge = colorBadge.success;
                    cl_change = colorBadge.success;
                    break;
                case (pricechange >= 0):
                    cl_change = colorBadge.success;
                    break;
                default:
                    break;
            }

            if (dump == true || pump == true) {
                $("#" + tokenName + " #tokenPill").html(badgeText);
                $("#" + tokenName + " #tokenPill").addClass("badge badge-pill float-right " + cl_badge);
                $("#" + tokenName + " #headerCard").addClass(cl_card);
            }
            $("#" + slug + " #badgePchange").addClass(cl_change);

            if (configScreener.graphDisplay) {
                $("#" + output + " .card-footer").css("display", "block");
            }
            // console.log(tokenName + " " + cl_change);
        }

        function info_CoinMarketCap_Global() {
            //console.log(cmc_urlAPIinformation+currency);
            var dateConvert = new Date();
            var cmcInfos;
            if (isTimeToGet(coolDown.cmc_global)) {
                console.log("Load CMC General Infos");
                // console.log("Get Last Visit : "+lastvisit + " ("+parseInt(minutes)+"min)");
                $.ajax({
                    url: cmc_urlAPIinformation + currency,
                    type: "GET",
                    dataType: 'json',
                    async: false,
                    //crossDomain: true,
                    success: function(data) {
                        //console.log(data);
                        cmcInfos = data;
                    }
                });
            } else {
                console.log("Read CMC General Infos");
                cmcInfos = JSON.parse(localStorage.getItem('cs_CMCinfos'));
                dateConvert = convertDate(cmcInfos.last_updated);
            }
            // console.log(cmcInfos["total_market_cap_" + currency.toLowerCase()]);
            // $("#lastupdate").html(dateConvert);
            // $("#gl_MC").html(cmcInfos["total_market_cap_" + currency.toLowerCase()], 4);
            $("#gl_MC").html(currencySym + nFormatter(cmcInfos["total_market_cap_" + currency.toLowerCase()], 4));
            $("#gl_Vol").html(currencySym + nFormatter(cmcInfos["total_24h_volume_" + currency.toLowerCase()], 4));


            if (cmcInfos["total_24h_volume_" + currency.toLowerCase()] < 10000000000) {
                $("#bt_glVol").addClass("btn-danger");
                // $("#bt_glVol").css("color", "white");
            } else if (cmcInfos["total_24h_volume_" + currency.toLowerCase()] >= 10000000000 && cmcInfos["total_24h_volume_" + currency.toLowerCase()] <= 20000000000) {
                $("#bt_glVol").addClass("btn-danger");
            } else if (cmcInfos["total_24h_volume_" + currency.toLowerCase()] >= 30000000000 && cmcInfos["total_24h_volume_" + currency.toLowerCase()] < 35000000000) {
                $("#bt_glVol").addClass("btn-success");
            } else if (cmcInfos["total_24h_volume_" + currency.toLowerCase()] >= 35000000000) {
                $("#bt_glVol").addClass("btn-success");
                // $("#bt_glVol").css("color", "white");
            }

            // $("#gl_MC").html(nFormatter(cmcInfos.total_market_cap_eur, 4)); 282843326504
            if (cmcInfos["total_market_cap_" + currency.toLowerCase()] < 100000000000) {
                $("#bt_glMC").addClass("btn-danger");
                // $("#bt_glMC").css("color", "white");
            } else if (cmcInfos["total_market_cap_" + currency.toLowerCase()] >= 100000000000 && cmcInfos["total_market_cap_" + currency.toLowerCase()] <= 200000000000) {
                // $("#cmc_mc").css("background-color", "green");
                $("#bt_glMC").addClass("btn-danger");
            } else if (cmcInfos["total_market_cap_" + currency.toLowerCase()] >= 300000000000 && cmcInfos["total_market_cap_" + currency.toLowerCase()] < 350000000000) {
                // $("#cmc_mc").css("background-color", "green");
                $("#bt_glMC").addClass("btn-success");
            } else if (cmcInfos["total_market_cap_" + currency.toLowerCase()] >= 350000000000) {
                // $("#bt_glMC").css("background-color", "green");
                $("#bt_glMC").addClass("btn-success");
            }


            // $("#curr_symb1").html(currencySym);
            // $("#curr_symb2").html(currencySym);
            // $("#curr_symb3").html(currencySym);



            if (cmcInfos.bitcoin_percentage_of_market_cap > 50) {
                $("#bt_glBTCDom").addClass("btn-danger");
            } else {
                $("#bt_glBTCDom").addClass("btn-success");
            }

            $("#gl_BTCdom").html(cmcInfos.bitcoin_percentage_of_market_cap + "%");

            // var dateConvert = convertDate(cmcInfos.last_updated);


        }

        function changeWalletBalance() {
            walletBalances.EUR = walletBalance;
            var last_walletBalances;
            if (localStorage.getItem("cs_balances") === null) {
                localStorage.setItem('cs_balances', JSON.stringify(walletBalances));
            } else {
                last_walletBalances = JSON.parse(localStorage.getItem("cs_balances"));
                gain_loss = walletBalance - parseFloat(last_walletBalances.EUR);
            }

            // console.log("wall: "+ walletBalance +" | last: " + last_walletBalances.EUR + " | g/l: " + gain_loss);
        }

        function eventsCryptoScreener() {
            $(".dropdown").on("show.bs.dropdown", function(event) {
                var idChoice = $(event.relatedTarget).attr('id'); // Get the text of the element
                var textChoice = $(event.relatedTarget).text(); // Get the text of the element
                if (idChoice == "currencyChoice") {
                    //$(event.relatedTarget).text("toto");
                }
                // console.log(textChoice);
                //$(event.relatedTarget).text("toto");
                // alert(x);
            });

            $(".dropdown-menu a").click(function() {
                var selCurrency = $(this).text();
                $("#currencyChoice").text(selCurrency);
                $(".dropdown-item").removeClass("active");
                $("#curr" + selCurrency).addClass("active");
                changeCurrency(selCurrency);
            });

            $(".form-check-input").change(function() {
                var choiceButton = $(this).parent().text();
                if (choiceButton == "Mode Online") {
                    configScreener.onlineMode = $(this).prop("checked");
                    if (configScreener.onlineMode) {
                        $("#modeCS").text("online");
                        $("#modeCS").removeClass("badge-danger");
                        $("#modeCS").addClass("badge-success");
                    } else {
                        $("#modeCS").text("offline");
                        $("#modeCS").removeClass("badge-success");
                        $("#modeCS").addClass("badge-danger");
                    }
                }

                if (choiceButton == "Wallet Local") {
                    configScreener.localWallet = $(this).prop("checked");
                }
                if (choiceButton == "Graphiques") {
                    configScreener.graphDisplay = $(this).prop("checked");
                    $("#lstCoins").html("");
                    $("#lstTokens").html("");
                    makeCard();
                }


                localStorage.setItem('cs_configuration', JSON.stringify(configScreener));
                // console.log(choiceButton);
            });

        }

        function majCryptoScreener() {
            $("#alert_msg").html("<strong>Attention !</strong> Mise à jour en cours.....");
            $("#alertRubbon").addClass("alert alert-info alert-dismissible fade show");
            var ready = false;
            var last_configScreener = JSON.parse(localStorage.getItem('cs_configuration'));
            console.log("MAJ CryptoScreener v" + last_configScreener.version + " to v" + configScreener.version);
            //console.log("Initialisation Variables Session" + configScreener.version);
            $.each(last_configScreener, function(element) {
                if (element != "version") {
                    configScreener[element] = last_configScreener[element];
                }
                //console.log("Maj: " + element + " = " + last_configScreener[element]);
            });
            localStorage.setItem('cs_configuration', JSON.stringify(configScreener));
        }

        function verifyCryptoSCreener() {

        }

        function infoCryptoScreener() {

        }
    </script>
</body>

</html>